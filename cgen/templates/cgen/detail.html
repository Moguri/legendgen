{% extends "cgen/base.html" %}
{% block content %}
<h1>Edit Character</h1>

<ul class="nav nav-tabs">
	<li class="active"><a href="#detail" data-toggle="tab">Details</a></li>
	<li><a href="#attributes" data-toggle="tab">Attributes</a></li>
	<li><a href="#todo" data-toggle="tab">Tracks</a></li>
	<li><a href="#todo" data-toggle="tab">Feats</a></li>
	<li><a href="#todo" data-toggle="tab">Items</a></li>
</ul>
{% if error_message %}<p class="alert alert-danger">{{ error_message }}</p>{% endif %}
		
<form class="form-horizontal" role="form" action="{% url 'cgen:save' char.id %}" method="post">
	{% csrf_token %}

	<div class="tab-content">
		<div id="detail" class="tab-pane fade in active">
			<div class="form-group">
				<label for="cname">Character Name</label>
				<input type="text" class="form-control" id="cname" name="cname" value="{{char.cname}}">
			</div>
			<div class="form-group">
				<label for="pname">Player Name</label>
				<input type="text" class="form-control" id="pname" name="pname" value="{{char.pname}}">
			</div>
			<div class="form-group">
				<label for="class_chassis">Class Chassis</label>
				<select class="form-control" name="class_chassis">
					{% for cc in classes %}
					<option value="{{cc.id}}" {% if cc.id == char.class_chassis.id %} selected {% endif %}>{{cc}}</option>
					{% endfor %}
				</select>
			</div>

		</div>

		<div id="attributes" class="tab-pane fade">
			<div class="form-group">
				<label for="kdm" class="control-label">KDM:</label>
				<span class="form-control-static">{{char.class_chassis.kdm}}</span>
			</div>
			<div class="form-group">
				<label for="kom" class="control-label">KOM:</label>
				<span class="form-control-static">{{char.class_chassis.kom}}</span>
			</div>
			{% for k, v in attribs.items %}
			<div class="form-group">
				<label for="{{k}}" class="col-sm-2 control-label">{{v.0}}</label>
				<div class="col-xs-2">
					<input type="number" class="form-control att-input" id="{{k}}" name="{{k}}" value="{{v.1}}">
				</div>
				<div class="col-xs-2">
					(<span id="{{k}}mod"></span>)
				</div>
			</div>
			{% endfor %}
		</div>

		<div id="todo" class="tab-pane fade">
			<p class="alert alert-danger">Todo</p>
		</div>
	</div>

	<button type="submit" class="btn btn-primary">Save</button>
	<a href="{% url 'cgen:index' %}" class="btn btn-default">Character List</a>
	<a href="{% url 'cgen:delete' char.id %}" class="btn btn-danger">Delete</a>
</form>
{% endblock %}

{% block script %}
<script>
	$(document).ready(function() {
		$('.att-input').each(function(i, v) {
			$('#' + $(this).attr('name') + 'mod').text(~~(($(this).val() - 10) / 2));
		});

		$('.att-input').change(function() {
			$('#' + $(this).attr('name') + 'mod').text(~~(($(this).val() - 10) / 2));
		});
	});
</script>
{% endblock %}
